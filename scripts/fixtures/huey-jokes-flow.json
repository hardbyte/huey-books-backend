{
  "seed_key": "huey-jokes",
  "name": "Huey Jokes",
  "description": "Optional post-recommendation joke loop. Shows age-appropriate jokes from CMS, looping until the user opts out.",
  "version": "1.1.0",
  "entry_node_id": "joke_intro",
  "visibility": "wriveted",
  "flow_data": {
    "nodes": [
      {
        "id": "joke_intro",
        "type": "question",
        "content": {
          "question": {"text": "Want to hear a joke while you're here? \ud83e\udd2a"},
          "input_type": "choice",
          "options": [
            {"label": "Yes please! \ud83d\ude02", "value": "yes"},
            {"label": "No thanks \ud83d\udc4b", "value": "no"}
          ],
          "variable": "temp.wants_joke"
        },
        "position": {"x": 100, "y": 300}
      },
      {
        "id": "check_wants_joke",
        "type": "condition",
        "content": {
          "conditions": [
            {"if": "temp.wants_joke.value == 'yes'", "then": "$0"}
          ],
          "default_path": "default"
        },
        "position": {"x": 300, "y": 300}
      },
      {
        "id": "pick_joke_messages",
        "type": "action",
        "content": {
          "actions": [
            {
              "type": "aggregate",
              "expression": "random_choice(['Give me a sec...\u231a', 'OK. Hold on... \u270b', 'Let me just find something...\ud83e\udd13', 'Hmm. Let me think\u2026 \ud83e\udd14', 'Let me see... \ud83d\udc40'])",
              "target": "temp.precursor_text"
            },
            {
              "type": "aggregate",
              "expression": "random_choice(['Ready for another joke? \ud83d\ude02', 'Another one? \ud83e\udd28', 'I have another joke! \ud83e\udd2a', 'One more joke? \ud83d\udc4c', \"Let's do that again! \ud83d\ude02\"])",
              "target": "temp.bridge_text"
            }
          ]
        },
        "position": {"x": 450, "y": 200}
      },
      {
        "id": "joke_precursor",
        "type": "message",
        "content": {
          "messages": [
            {"type": "text", "text": "{{temp.precursor_text}}"}
          ],
          "typing_indicator": true
        },
        "position": {"x": 600, "y": 200}
      },
      {
        "id": "joke_question",
        "type": "question",
        "content": {
          "source": "random",
          "source_config": {
            "type": "question",
            "tags": ["huey-joke"],
            "info_filters": {
              "min_age": "${user.age_number}",
              "max_age": "${user.age_number}"
            },
            "exclude_from": "temp.shown_joke_ids"
          },
          "track_shown_in": "temp.shown_joke_ids",
          "variable": "temp.current_joke",
          "input_type": "choice"
        },
        "position": {"x": 800, "y": 200}
      },
      {
        "id": "show_punchline",
        "type": "message",
        "content": {
          "messages": [
            {"type": "text", "text": "{{temp.current_joke.punchline}}"},
            {"type": "image", "content": {"url": "{{temp.current_joke.reward_url}}", "alt": ""}}
          ],
          "typing_indicator": true
        },
        "position": {"x": 1000, "y": 200}
      },
      {
        "id": "joke_bridge",
        "type": "question",
        "content": {
          "question": {"text": "{{temp.bridge_text}}"},
          "input_type": "choice",
          "options": [
            {"label": "Yes! \ud83e\udd2a", "value": "yes"},
            {"label": "No thanks \ud83d\ude04", "value": "no"}
          ],
          "variable": "temp.wants_joke"
        },
        "position": {"x": 1200, "y": 200}
      },
      {
        "id": "joke_goodbye",
        "type": "message",
        "content": {
          "messages": [
            {"type": "text", "text": "No problem! \ud83d\ude04"}
          ]
        },
        "position": {"x": 500, "y": 450}
      }
    ],
    "connections": [
      {"source": "joke_intro", "target": "check_wants_joke", "type": "default"},
      {"source": "check_wants_joke", "target": "pick_joke_messages", "type": "$0"},
      {"source": "check_wants_joke", "target": "joke_goodbye", "type": "default"},
      {"source": "pick_joke_messages", "target": "joke_precursor", "type": "default"},
      {"source": "joke_precursor", "target": "joke_question", "type": "default"},
      {"source": "joke_question", "target": "show_punchline", "type": "default"},
      {"source": "show_punchline", "target": "joke_bridge", "type": "default"},
      {"source": "joke_bridge", "target": "check_wants_joke", "type": "default"}
    ]
  }
}
